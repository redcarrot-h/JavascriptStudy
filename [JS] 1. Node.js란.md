## Node.js

### 1.1 Node.js란?
Node.js는 Chrome V8 JavaScript 엔진으로 빌드된 JavaScript 런타임입니다.
 - JavaScript 런타임 : 자바스크립트로 구현된 프로그램을 해석하고 실행할 수 있는 환경을 뜻함

### 1.2 Node.js의 특징
Node.js는 논블로킹(Non-blocking) I/O와 싱글 스레드(Single Thread), 이벤트 루프(Event Loop)를 통한 높은 처리 성능을 가지고 있음  

#### 1.2.1 논블로킹(Non-blocking) I/O
##### 1. 블로킹(Blocking): 함수를 호출하면 호출된 함수가 작업을 마칠 때까지 제어권을 돌려주지 않고 함수가 종료될 때까지 대기하는 방식, 함수를 호출하고 나면 함수가 완전히 종료가 될 때까지 다른 작업을 진행하지 못하고 기다려야 하는 것.  
-  블로킹 I/O로 파일 쓰기할 때의 작업 프로세스:  
		 함수를 호출해서 파일 쓰기를 요청합니다. -> 파일 쓰기를 실행합니다. 
		-> 파일 쓰기가 완료될 때까지 다음 코드를 실행하지 않고 대기(blocking 상태)가 됩니다. 
		-> 파일 쓰기가 완료되면 다음 코드를 실행합니다.

##### 2. 논블로킹(Non-blocking): 함수를 호출하면 호출된 함수에게 바로 제어권을 넘겨줘서 다른 작업을 바로 진행할 수 있도록 하는 방식, 함수를 호출한 후 호출된 함수가 실행되는 중에도 다른 작업을 동시에 진행할 수 있다는 것을 의미.  
 - 논블로킹 I/O로 파일 쓰기할 때의 작업 프로세스:  
		함수를 호출해서 파일 쓰기를 요청합니다. -> 바로 다음 코드를 실행합니다. -> 파일 쓰기가 실행됩니다. -> 파일 쓰기가 완료되면 콜백(Callback) 함수를 호출해서 파일 쓰기가 완료되었음을 알려줍니다. -> 파일 쓰기 완료 후 실행해야 할 프로그램을 실행합니다.

##### 3. 블로킹 I/O (동기식 I/O), 논블로킹 I/O(비동기식 I/O)

#### 1.2.2 싱글 스레드(Single Thread)
싱글 스레드라는 것은 스레드 하나를 사용한다는 의미, 동시에 하나의 작업만을 처리할 수 있다는 뜻 <-> 멀티 스레드(Multi Thread) : 동시에 여러 개의 스레드를 이용해서 동시에 여러 작업을 진행할 수 있는 프로그래밍 방식

##### 컴퓨터의 작업 처리 방법
컴퓨터는 작업을 처리하기 위해서 '프로세스'라는 작업 단위를 두고 프로세스를 통해서 작업을 처리합니다. 컴퓨터에서 동작하는 Node.js를 포함한 여러 가지 프로그램은 개별적인 프로세스로 리소스(CPU, 메모리, 저장 공간 등)를 할당받고 실행됩니다. 스레드는 프로세스 안에서 작업을 처리하기 위해 실행되는 흐름의 단위인데 하나의 프로세스는 여러개의 스레드를 생성해서 여러 작업을 동시에 처리할 수 있습니다.  
자바는 멀티 스레드를 이용하고 Node.js는 싱글 스레드를 사용합니다. 

##### 멀티 스레드와 싱글 스레드
멀티 스레드 방식을 사용하면 동시에 여러 작업을 실행할 수 있어서 성능 면에서는 좋을지 모르지만 굉장히 많은 자원을 필요로 하게 되고, 때로는 자원이 제대로 사용되지 않는 비효율이 생길 수도 있습니다.  
 Node.js는 싱글 스레드를 사용하지만, 싱글 스레드의 약점을 극복하기 위해서 논블로킹(Non-blocking)을 사용하여 파일 쓰기, 네트워크를 통한 데이터베이스 처리 등의 작업을 하는 동안 컴퓨터가 쉬지 않고 다른 작업을 바로 실행시킬 수 있게 합니다. 이로 인해 적은 자원으로도 큰 효율을 낼 수 있도록 구성된 것입니다.   
정리하자면 Node.js는 자바스크립트를 실행하는 부분에 대해서만 싱글 스레드로 구성되고, 논블로킹 I/O와 이벤트 루프를 통해서 동시에 여러 작업을 할 수 있도록 해줍니다.

#### 1.2.3 이벤트 루프(Event Loop)
Node.js는 크롬 V8 자바스크립트 엔진과 libuv, llhttp, c-ares, OpenSSL, zlib라는 라이브러리로 구성되어 있습니다. 이중 libuz 라이브러리는 이벤트 루프를 통해서 자바스크립트가 가지고 있던 싱글 스레드의 약점을 극복하고 효율적으로 작업을 처리할 수 있도록 고안되었습니다.

이벤트 루프에 대해 설명하기 위해 크롬 V8 자바스크립트 엔진이 어떻게 동작이 되는지 살펴보겠습니다. 자바스크립트 엔진은 다음 2개의 주요 컴포넌트로 이루어집니다.
 - 메모리 힙(Memory Heap): 메모리 할당이 일어나는 컴포넌트
 - 콜 스택(Call Stack): 코드 실행을 위한 컴포넌트

자바 스크립트 엔진이 아니라 브라우저 자체에서 제공하는 기능인 DOM, AJAX, Timeout 같은 기능을 Web APIs라고 부릅니다.

자바스크립트는 싱글 스레드 언어이고, 이것은 하나의 콜 스택(Call stack)을 가지고 있는 것을 의미합니다. 그래서 한 번에 하나의 작업만을 처리할 수 있습니다. 스택(Stack)은 프로그래밍에서 사용되는 자료 구조 중 하나로 선입후출(FIFO, First In Last Out)의 규칙을 따릅니다. 자바스크립트는 처리해야 할 작업을 콜 스택에 쌓고 하나씩 처리합니다.

자바스크립트가 콜 스택에서 실행한 비동기 함수는 Web APIs를 호출하고, Web APIs는 콜백 함수를 콜백 큐(Callback Queue)에 밀어 넣습니다. 큐(Queue)는 자료 구조 중 하나로 선입선출(FIFO, First In First Out)의 규칙을 따릅니다.

이벤트 루프(Event Loop)는 콜 스택과 콜백 큐의 상태를 체크하고, 콜 스택이 빈 상태가 되면 콜백 큐의 첫번째 콜백을 콜 스택으로 이동시킵니다. 이러한 작업이 반복적으로 일어나고, 이런 반복적인 행동을 틱(tick)이라고 합니다. 그래서 자바스크립트만 보면 싱글 스레드 언어이고 한 번에 하나의 작업만 실행할 수 있지만, 브라우저 내에서 비동기 함수인 Web APIs와 콜백 큐, 이벤트 루프 때문에 멀티 스레드처럼 동시에 다중 작업을 처리하는 효과를 볼 수 있습니다. 

다시 Node.js를 살펴보겠습니다. Node.js는 논블로킹(비동기) I/O를 지원하기 위해서 libuv라는 라이브러리에 이벤트 루프가 구현되어 있습니다. Node.js에서 자바스크립트 엔진은 비동기 처리를 위해 Node.js의 API를 호출하며, 이때 넘겨진 콜백은 libuv의 이벤트 루프를 통해서 스케줄링되고 실행됩니다. 

Node.js는 싱글 스레드이지만 Cluster 모듈이나 PM2를 사용하여 멀티 스레드의 효과를 볼 수 있습니다. 정확히는 싱글 스레드인 Node.js가 CPU 코어를 추가적으로 사용하여 작업을 병렬적으로 처리하는 것이 가능합니다. 즉, CPU 코어 하나당 프로세스 하나가 실행이 되는데, 여러 개의 코어를 사용해서 여러 개의 프로세스로 Node.js를 실행시키는 것입니다. 이것을 클러스터링(Clustering)이라고 합니다. 이렇게 되면 요청을 분산시키고 병렬로 처리할 수 있기 때문에 멀티 스레드 언어와 동일한 효과를 볼 수 있습니다.

### 1.3 npm(Node Package Manager)
npm은 Node.js 기반으로 개발된 수많은 자바스크립트 패키지(라이브러리)가 등록되어 있어서 개발자들이 쉽게 설치하고, 사용하고, 운영할 수 있도록 해주는 Node.js 패키지 관리자 입니다. npm에는 전 세계 개발자들이 개발한 약 100만 개 이상의 모듈이 등록되어 있습니다. npm은 오늘날 자바스크립트가 전 세계 개발자들로부터 가장 사랑받는 언어가 되게 한 결정적인 역할을 하고 있습니다.
